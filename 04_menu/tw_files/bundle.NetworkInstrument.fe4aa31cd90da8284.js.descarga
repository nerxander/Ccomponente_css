webpackJsonp(["bundle.NetworkInstrument"],{"7BPk":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"default",function(){return h});var r=n("n12u"),i=(n.n(r),n("EuXz")),o=(n.n(i),n("Z8+c")),s=n.n(o),a=n("fKPv"),u=n.n(a),_=n("6Ew8"),c=n("d39v"),d=n("IIZ1"),p=n("8Mxi"),f=n.n(p),m=[c.a.BadOauthToken,c.a.OauthTimestampException,c.a.BadAuthenticationData,c.a.AccessDeniedByBouncer],h=function(){function e(e,t){var n=this;u()(this,"scribeRequest",function(e){var t=e.response,r=e.error,i=s()(e,["error"]),o=new window.URL(i.url);if((!r&&t||(t={headers:{},body:"",status:r?r.status:500},r instanceof _.a))&&0!==o.pathname.indexOf("/1.1/jot")){n._flushResourceTimingBuffer();var a=Object(d.findLast)(n._buffer,function(e){var t=e.request;return o.protocol===t.uri_scheme&&o.hostname===t.uri_host_name&&o.pathname===t.uri_path&&(o.query||"")===t.uri_query});if(a){var u=n._buffer.indexOf(a);n._buffer[u]=n._updateEventWithRequestResponse(a,i,t,r)}else{var c=n._updateEventWithRequestResponse(n._prepareEvent(i.url),i,t,r);n._buffer.push(c)}n._flushBuffer()}}),u()(this,"_flushResourceTimingBuffer",function(){if(n._resourceTimingApiSupported){var e=window.performance.getEntriesByType("resource");window.performance.clearResourceTimings(),e.forEach(function(e){if(e.name){var t=n._updateEventWithPrecisionTimings(n._prepareEvent(e.name),e);n._buffer.push(t)}})}}),u()(this,"_updateNetworkInfo",function(e){n._networkInfo=e}),u()(this,"_getNetworkMeasurements",function(){return{connection_type:n._networkInfo.type||"unknown",speed_class:n._networkInfo.effectiveType,download_mbps:n._networkInfo.downlink,download_max_mbps:n._networkInfo.downlinkMax,rtt_ms:n._networkInfo.rtt,reduced_data_usage:n._networkInfo.saveData}}),this._resourceTimingApiSupported=window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("resource")&&window.performance.clearResourceTimings,this._scribe=e,this._options=Object.assign({apiErrorSampleSize:0,apiSampleSize:0,cdnSampleSize:0,cdnHostList:[]},t),this._buffer=[],this._networkInfo={},f.a.getConnectionInfo().then(function(e){n._updateNetworkInfo(e),f.a.addEventListener("connectionChange",n._updateNetworkInfo)}),this._resourceTimingApiSupported&&(window.performance.onresourcetimingbufferfull=this._flushResourceTimingBuffer)}var t=e.prototype;return t._flushBuffer=function(){var e=this;this._buffer.splice(0,this._buffer.length).forEach(function(t){e._sample(t)&&e._scribe.log(void 0,t)})},t._sample=function(e){var t=e.event_type,n=this._options[{"api:all":"apiSampleSize","api:error":"apiErrorSampleSize","cdn:all":"cdnSampleSize"}[t]]||0;return Math.random()<n},t._getEventType=function(e,t){return this._options.cdnHostList.indexOf(e)>-1?"cdn:all":t>=200&&t<300?"api:all":"api:error"},t._prepareEvent=function(e){var t=new window.URL(e),n="api.twitter.com"===t.hostname;return{_category_:"client_network_request_event",request:{uri_scheme:t.protocol,uri_host_name:t.hostname,uri_path:t.pathname,uri_query:t.query||"",http_method:"GET",http_status_code:n?0:200,start_time_ms:Date.now(),request_details:{duration_ms:0}},common_header:{commonHeader:{clientHeader:{timestampMs:Date.now(),timezoneOffsetMin:-(new Date).getTimezoneOffset()}}},network_measurements:this._getNetworkMeasurements(),event_type:this._getEventType(t.hostname,200),event_source:"rweb"}},t._extractApiErrorCode=function(e){var t=e.errors,n=(void 0===t?[]:t).map(function(e){return e.code}).filter(function(e){return void 0!==e}),r=Object(d.find)(n,function(e){return m.indexOf(e)>-1});return r||(n.length>0?n[0]:void 0)},t._updateEventWithRequestResponse=function(e,t,n,r){var i=e.request.request_details;return Object.assign({},e,{request:Object.assign({},e.request,{http_method:t.method,http_status_code:n.status,start_time_ms:t.startTimestamp,trace_id:t.headers["x-b3-traceid"],twitter_api_error_code:r&&this._extractApiErrorCode(r)||void 0,request_details:Object.assign({},i,{duration_ms:i.duration_ms||t.endTimestamp-t.startTimestamp,request_body_size:i.request_body_size||("string"==typeof t.data?t.data.length:t.data?JSON.stringify(t.data).length:void 0),response_body_size:i.response_body_size||(n&&n.body?n.body.length:void 0)})}),event_type:this._getEventType(e.request.uri_host_name,n.status)})},t._getTiming=function(e,t){return Object(d.isFinite)(e)&&Object(d.isFinite)(t)?Math.round(t-e):void 0},t._updateEventWithPrecisionTimings=function(e,t){return Object.assign({},e,{request:Object.assign({},e.request,{request_details:Object.assign({},e.request.request_details,{duration_ms:Math.round(t.responseEnd-t.fetchStart),rx_bytes:t.transferSize,dns_ms:this._getTiming(t.domainLookupStart,t.domainLookupEnd),tcp_ms:this._getTiming(t.connectStart,t.connectEnd),tls_ms:0===t.secureConnectionStart?void 0:Math.round(t.connectEnd-t.secureConnectionStart),response_body_size:t.decodedBodySize})})})},e}()}});
//# sourceMappingURL=https://ton.smf1.twitter.com/responsive-web-internal/sourcemaps/web/bundle.NetworkInstrument.fe4aa31cd90da8284.js.map